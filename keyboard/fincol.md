# FinCol 配列

## 参考にした配列

配列の説明の前に、好き勝手にキーボードの配列(キーマップ)を作ろうというキッカケになった情報をふたつ。

- Eucalyn 配列
  - http://eucalyn.hatenadiary.jp/entry/about-eucalyn-layout
  - http://eucalyn.hatenadiary.jp/entry/saikyo-interface
  - https://yushakobo.jp/blog/pluis9/2017/12/thinkkeylayout
- ことのは『居合』
  - https://scrapbox.io/UNDER30KEYBOARD/%E3%81%93%E3%81%A8%E3%81%AE%E3%81%AF%E3%80%8E%E5%B1%85%E5%90%88%E3%80%8F
  - https://twitter.com/X___MOON___X/status/1067764111608471552

Eucalyn 配列は論理的な配列である。ローマ字入力での日本語の打ちやすさをかなり重要視したものだ。
印象的な点は、左手に母音 5 キー、右手によく使う子音キーを配置していることである。

一方の居合は物質的 (*) な配列である。一見してとがりまくった配列になっている。似たもの探すのが
難しいのではないだろうか。
印象的な点は、3 段 5 列の配列から大きく離れた 2 段 6 列であることと、
親指にアルファベットキーを割当てていることである。

(*) 物理は論理的であるため、物理的という単語は論理的と対照させるのは居心地が悪い。

## 方針

キーマップを考えるに当たり某社のオフィスでキーボードを打っている人たちの姿を観察した。
ソフトウェア系の会社であるため、もちろんコード書きもあるわけだが、キーボードを勢い良く打っている時は
チャット、Twitter の場面が多かった。「コードを書く」とはいうが、コード書きの重要な場面は
思考なので (*) 、コード書きの場面ではキーボードを打つ速度は律速ではないと判断した。
そしてチャットや Twitter に書くときの言語は、現在のぼくはほぼ日本語である。
そこで Eucalyn 配列と同じく、ローマ字入力の打ちやすさを方針の第一番目とすることに決めた。

(*) ボイラープレートが多い言語やものすごいスピードで打つ(であろう)競技系のコードはここでは考えていない。

次に、自分の指の動かしやすさ(または動かしにくさ)について考えたところ、
小指が動きが悪いことがキーを打っているときなストレスのように思えた。
特に左手の小指が動かしづらい。一方、普通のキーボード/QWERTY 配列では小指はそこそこ忙しく、
左手はコントロールキーやシフトキー、右手は記号系やエンターキーなどを担当する。
これを改善すべく、3 段で 4 列の配列を模索することとした。
4 つの指(Finger)をそれぞれ列(Column)に割り当てるということで、FinCol 配列と呼ぶとこにする。

## 枠

枠として、3 段 4 列を採用する。親指は左右それぞれ 2 キーとする。

```
 ,-----------------------.              ,-----------------------.
 |     |     |     |     |              |     |     |     |     |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |     |     |     |              |     |     |     |     |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |     |     |     |              |     |     |     |     |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   |     |     |  |     |     |
                   `-----------'  `-----------'
```

場所を表すため次の記号を用いる。数字は指番号で 1 から 4 が人差し指から小指を、0 が親指を示す。
U, M, L は上段(upper), 中段(middle), 下段(lower) である。

```
 ,-----------------------.              ,-----------------------.
 | 4U  | 3U  | 2U  | 1U  |              | 1U  | 2U  | 3U  | 4U  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 | 4M  | 3M  | 2M  | 1M  |              | 1M  | 2M  | 3M  | 4M  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 | 4L  | 3L  | 2L  | 1L  |              | 1L  | 2L  | 3L  | 4L  |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   | 0U  | 0M  |  | 0M  | 0U  |
                   `-----------'  `-----------'
```

ホームポジションは M がついたキーである。
また、左右を明示したい場合は、R1M などと書き、これは右手、人差し指列、中段を表す。

## 母音 5 キーの配置

まず Eucalyn 配列に倣って、母音 5 キーを左手側に配置する。
人差し指から小指まででは 4 列しか無いためひとつ足りない。
もうひとつの置き方としては、上段または下段に配置する方法と、親指に割り当てる方法が思い浮かぶ。
ここでは、ホームポジションで母音が打てることを重視し、居合に受けた刺激を踏まえて親指ホームポジションを用いる。

枠内の 5 キーの位置は決まったのであとは A, I, U, E, O を割り当てるかだけである。
ここの割当てにはあまり良いクライテリアを思いつかなかった。
そこでそのままの順序で割り当てることにする。なにかより良いクライテリアがあれば変えれば良い。
また、右手親指ホームポジション(R0M)にはスペースキーを割り当てる。空白は日本語でも用いるし、
IME の選択時にもよく用いるためである。

```
 ,-----------------------.              ,-----------------------.
 |     |     |     |     |              |     |     |     |     |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  A  |  I  |  U  |  E  |              |     |     |     |     |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |     |     |     |              |     |     |     |     |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   |     |  O  |  | SP  |     |
                   `-----------'  `-----------'
```

## 子音の配置、その 1

次はやはり Eucalyn 配列に倣ってローマ字入力でよく使う子音を左手のホームポジションに配置することにする。
最初にも上げた次のページを見ると

- キー配列頂上決戦！さいつよなレイアウトはどれだ！ | 遊舎工房
  - https://yushakobo.jp/blog/pluis9/2017/12/thinkkeylayout

日本語では K, S, T, N, H, M, R あたりがよく使われるようだ。このうち 4 つを右手ホームポジションに
割り当てる。ここでは S, T, M, R の 4 つとした。
K, N は頻度がかなり高いと考えられるが、後述の理由により、このもっとも打ちやすい 4 つからは除外した。
S, T, M, R の配置は次のように決める。

- 一番頻度が低そうな R を小指とする
- C-m (コントールキーを押しながら M を押す意味)をエンターに割当てて使うため、一番偉そうな人差し指とする
- あとは良い勝負な気がするので適当

```
 ,-----------------------.              ,-----------------------.
 |     |     |     |     |              |     |     |     |     |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  A  |  I  |  U  |  E  |              |  M  |  S  |  T  |  R  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |     |     |     |              |     |     |     |     |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   |     |  O  |  | SP  |     |
                   `-----------'  `-----------'
```

## 子音の配置、その 2

子音の次の段階として、右手側の上段と下段を埋める。ここまででローマ字入力が楽になるという方針を
第ゼロ近似として達成しているはずである。この左記の配置を決める理由は大雑把になり、またローマ字入力以外の
理由も採用しつつ続けていく。

チャット、Twitter 以外に目を向けると、キーボードをよく使うソフトウェアはエディタ(Emacs)と
ターミナル(GNU Screen)である。そこで B/N/P/F と H/J/K/L を使いやすくしてみようと思い立った。
ローマ字入力ではよく使うキーである N, K を、右手ホームポジションから外した理由がこれである。
一列に並べるため、QWERTY の H/J/K/L に倣い、←↓↑→の順序を採用し、B/N/P/F としている。

あとはどちらを上段と下段に配置するかだけである。この決め手としてはよく使う N と K を打ちやすい
位置に置くこととする。N は人差し指、K は薬指で、上段は中指が一番打ちやすい (*) ため、B/N/P/F を
上段とする。

(*) これは人に依ると思う。

うまいことあまり使わないであろう F と L が打ちにくい小指に割当てられたのは偶然だが良いハマりぐあいである。

```
 ,-----------------------.              ,-----------------------.
 |     |     |     |     |              |  B  |  N  |  P  |  F  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  A  |  I  |  U  |  E  |              |  M  |  S  |  T  |  R  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |     |     |     |              |  H  |  J  |  K  |  L  |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   |     |  O  |  | SP  |     |
                   `-----------'  `-----------'
```

## 子音の配置、その 3

残りはかなりどうでもいいが一応なるべく理詰めで行く。
ちなみに残ったキーは C, D, G, Q, V, W, X, Y, Z の 9 キーである。

最初に右手の親指 (R0U) に置くキーを考える。右手側の 12 個の子音から落ちてはいるが
ローマ字入力で使いそうなものとしては G, Y と Z あたりが候補に上がってくる。
このうち Y は、拗音で子音の次に来ることもある。たとえば「きゃ(KYA)」の打鍵を考えると
R3L, R0U, L4M となる。右手の薬指から親指の連続は違和感があるため、Y は候補から外す。

G と Z にはあまり違いを感じない。個人的に C-z をアプリ内での選択(Emacs のバッファ選択、
GNU screen の window 選択、Slack のチャンネル選択)に共通で使っているため Z を特別視して
親指に割り当てることとした。

のこりは右手側に割り当てる。よく使いそうなのにここまで残ってしまった G を最も打ちやすい
L2U に配置する。
Y は特殊で A, U, O とのみ絡む(ローマ字入力の範囲で)ためそれらの列を避けて配置する。
ここまでの空きのなかで打ちやすい L1L に配置する。

あまり使わない Q と V は小指に割り当てる。上段のほうが
打ち辛いので、より使わ無さそうな Q が上段で V を下段とした。

あとはもうエイヤである。

```
 ,-----------------------.              ,-----------------------.
 |  Q  |  D  |  G  |  C  |              |  B  |  N  |  P  |  F  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  A  |  I  |  U  |  E  |              |  M  |  S  |  T  |  R  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  V  |  X  |  W  |  Y  |              |  H  |  J  |  K  |  L  |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   | LA  |  O  |  | SP  |  Z  |
                   `-----------'  `-----------'
```

ついでに L0U の空き位置にランチャキー(キーコードは F2 だが被らなければ何でも良い)を
アサインしている。デスクトップ側のキーボードショートカットでランチャにマップしている。
ここでのランチャとは Mac の QuickSilver とか Kupfer のようなものを指す。現在は自作の雑なやつを
使っている。

## レイヤー SY (symbol)

アルファベットが決まったため、あとは記号などをレイヤーでは位置する。
レイヤーは多いとコンガラガッてしまうため、なるべく少なくする。基本は記号レイヤーだけですます。

記号レイヤー SY には、まず左手に数字を配置、右手にはホームポジションに日本語入力でもよく使うキーを配置する。
蛇足だが、左手に数字なのは簿記の勉強をしていた時に右手にペン、左手に電卓というのが残っていたからである。

```
 ,-----------------------.              ,-----------------------.
 |     |  7  |  8  |  9  |              |     |     |     |     |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  0  |  4  |  5  |  6  |              |  -  |  ,  |  .  |  /  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |  1  |  2  |  3  |              |     |     |     |     |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   |     |     |  |     |     |
                   `-----------'  `-----------'
```

あとは適当に覚えやすい程度にキーを振っていく。

```
 ,-----------------------.              ,-----------------------.
 |     |  7  |  8  |  9  |              |  "  |  [  |  ]  |  ~  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  0  |  4  |  5  |  6  |              |  -  |  ,  |  .  |  /  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |  1  |  2  |  3  |              |  =  |  ;  |  :  |  \  |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   |     |     |  |     |     |
                   `-----------'  `-----------'
```

## レイヤー SS (shifted symbol)

もうひとつのレイヤーは(ほぼ) 記号レイヤーに Shift が入っただけのものである。

```
 ,-----------------------.              ,-----------------------.
 |Enter|  &  |  *  |  )  |              |  '  |  {  |  }  |  `  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |  (  |  $  |  %  |  ^  |              |  _  |  <  |  >  |  ?  |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |CapsL|  !  |  @  |  #  |              |  =  |sh_l |sh_r |  |  |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   |     |     |  |     |     |
                   `-----------'  `-----------'
```

Shift とズレているのは以下の 3 種類のみ:

- 括弧の開きとじ: L4M と L1U を逆にしている。開き括弧をホームポジションに持ってくるため。
  うまく electric paren が発動すれば閉じ括弧は打たなくて良いので、上段への移動が無くなる。
- コロンとセミコロン: コロンはそこそこ使う(Erlang とか)ため、SYMBOL レイヤーにおいた
- sh_l, sh_r: これらは Shift とカーソルの左右キー同時押しを指す。Mozc の変換範囲変更で使う。

その他、Enter と CapsLock をここに置いている。

## モディファイヤ

ここでは、コントール、Alt、シフトの修飾キーと長押しでのレイヤー切り替え(qmk_firmware の LT)をまとめて
モディファイヤと呼ぶ。
どちらも長押しで他のキーと同居させる。
コントール、Alt を押しながら記号キーを押すこともあるため、左にコントールと Alt, 右に SYMBOL, S_SYMB の
切り替えを置く。
また Shift は小指ホームに同居させている。

```
 ,-----------------------.              ,-----------------------.
 |     |     |     |     |              |     |     |     |     |
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |Shift|     |     |     |              |     |     |     |Shift|
 |-----+-----+-----+-----|              |-----+-----+-----+-----|
 |     |     |     |     |              |     |     |     |     |
 `-----------------------'              `-----+-----------------'
                   ,-----------.  ,-----------.
                   | Alt |Ctrl |  | SY  | SS  |
                   `-----------'  `-----------'
```

## OS 側でのリマップ

ここに書いたキーだけではいろんなアプリを上手く操作できないこともあるので、OS 側でリマップを行っている。
これはまた別のメモに書く(予定)。

## 実用中ののキーマップ

2020-09-14 現在、物質的キーボードとしては Claw44 を使っており、キーマップは次のところに置いてある。
https://github.com/shino/qmk_firmware/blob/develop/keyboards/claw44/keymaps/shino/keymap.c
ちょくちょく変えているのでこの記事と外れているかもしれない。

- Claw44 は 6 列なので余っている左右 1 列ずつに適当にキーを割り振っている。
  - Youtube とかをダラダラ見ている時に押すようなキー
- マウスキーレイヤもいちおう定義している
  - 使いこなせてはいない
